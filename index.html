<!doctype html><html lang="bg"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>PV –ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300..800;1,9..40,300..800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#080c14;--card:#0d1422;--card2:#131b2e;--text:#e4ebf8;--muted:#8694ad;--dim:#4f5d73;--line:rgba(255,255,255,.07);--sun:#f5c542;--sun-dim:rgba(245,197,66,.12);--green:#34d399;--green-dim:rgba(52,211,153,.1);--amber:#fbbf24;--amber-dim:rgba(251,191,36,.1);--red:#f87171;--red-dim:rgba(248,113,113,.1);--blue:#60a5fa;--blue-dim:rgba(96,165,250,.1);--cyan:#22d3ee}
*{box-sizing:border-box;margin:0;padding:0}html{-webkit-text-size-adjust:100%}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.55;min-height:100dvh;overscroll-behavior-y:contain}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 55% 45% at 15% 8%,rgba(245,197,66,.03),transparent),radial-gradient(ellipse 45% 35% at 85% 85%,rgba(96,165,250,.02),transparent)}
.wrap{position:relative;z-index:1;max-width:1440px;margin:0 auto;padding:0 14px 20px}
header{padding:16px 0 6px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--sun),#d4890a);display:grid;place-items:center;font-size:18px;box-shadow:0 3px 14px rgba(245,197,66,.22)}
h1{font-size:19px;font-weight:700;letter-spacing:-.3px}.sub{color:var(--muted);font-size:12px}
.hdr-btns{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.lang-toggle{display:flex;border:1px solid var(--line);border-radius:9px;overflow:hidden}
.lang-btn{padding:7px 14px;font-size:13px;cursor:pointer;background:transparent;color:var(--muted);border:none;font-family:inherit;display:flex;align-items:center;gap:6px;transition:all .15s}
.lang-btn:hover{background:rgba(255,255,255,.04)}.lang-btn.active{background:rgba(245,197,66,.1);color:var(--sun);font-weight:600}
.reset-btn{padding:7px 14px;font-size:12px;cursor:pointer;background:rgba(248,113,113,.08);color:var(--red);border:1px solid rgba(248,113,113,.2);border-radius:9px;font-family:inherit;transition:all .15s}
.reset-btn:hover{background:rgba(248,113,113,.15)}
.grid3{display:grid;grid-template-columns:1fr 1fr 480px;gap:14px;margin-top:14px;align-items:start}
@media(max-width:1200px){.grid3{grid-template-columns:1fr 1fr}.grid3>.col-r{grid-column:1/-1}}
@media(max-width:740px){.grid3{grid-template-columns:1fr}.col-r .card{position:static!important}}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px 18px}
.sec{margin-top:14px;padding-top:12px;border-top:1px solid var(--line)}.sec:first-child{margin-top:0;padding-top:0;border-top:none}
.stitle{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;color:var(--muted);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.stitle::before{content:'';width:3px;height:10px;border-radius:2px;background:var(--sun)}
.fld{margin:6px 0}.frow{display:flex;justify-content:space-between;align-items:baseline;gap:6px;margin-bottom:2px}
.flbl{font-size:12px;color:var(--muted)}.fval{font-family:'JetBrains Mono',monospace;font-size:12.5px;color:var(--text);white-space:nowrap}
.fhint{display:flex;justify-content:space-between;font-size:9.5px;color:var(--dim)}
.fcomp{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700;color:var(--sun);padding:4px 0}
.fsmall{font-size:10px;color:var(--dim);margin-top:1px}
.szone{position:relative;padding:18px 14px;margin:0 -14px}
.szone.big{padding:22px 14px}
input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:6px;border-radius:3px;background:rgba(255,255,255,.09);outline:none;cursor:pointer;touch-action:auto}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:30px;height:30px;border-radius:50%;background:var(--sun);border:3px solid var(--bg);box-shadow:0 2px 10px rgba(0,0,0,.5);cursor:grab}
input[type=range]::-moz-range-thumb{width:30px;height:30px;border-radius:50%;background:var(--sun);border:3px solid var(--bg);box-shadow:0 2px 10px rgba(0,0,0,.5);cursor:grab}
input[type=range].warn::-webkit-slider-thumb,input[type=range].warn::-moz-range-thumb{background:var(--amber);box-shadow:0 0 12px rgba(251,191,36,.5)}
input[type=range].danger::-webkit-slider-thumb,input[type=range].danger::-moz-range-thumb{background:var(--red);box-shadow:0 0 14px rgba(248,113,113,.6)}
.fval.warn-text{color:var(--amber);text-shadow:0 0 8px rgba(251,191,36,.4)}.fval.danger-text{color:var(--red);text-shadow:0 0 8px rgba(248,113,113,.5)}
select{width:100%;padding:10px 12px;border-radius:9px;border:1px solid var(--line);background:var(--card2);color:var(--text);font-family:inherit;font-size:13px;outline:none}
.pills{display:flex;flex-wrap:wrap;gap:5px}
.pill{padding:7px 12px;border-radius:999px;border:1px solid var(--line);background:transparent;color:var(--muted);font-size:11.5px;font-family:inherit;cursor:pointer;transition:all .12s;white-space:nowrap}
.pill:hover{border-color:rgba(245,197,66,.25);color:var(--text)}.pill.on{background:var(--sun-dim);border-color:rgba(245,197,66,.45);color:var(--sun);font-weight:600}
.pbtn{padding:6px 10px;border-radius:9px;border:1px solid var(--line);background:rgba(96,165,250,.04);color:var(--blue);font-size:11px;font-family:inherit;cursor:pointer;transition:all .12s;display:inline-flex;align-items:center;gap:4px}
.pbtn:hover{background:rgba(96,165,250,.1)}.pbtn.on{background:var(--blue-dim);border-color:rgba(96,165,250,.4);font-weight:700}
.split{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:500px){.split{grid-template-columns:1fr}}
.tip{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:rgba(255,255,255,.07);color:var(--dim);font-size:10px;font-weight:700;cursor:pointer;margin-left:4px;vertical-align:middle;position:relative;user-select:none;transition:all .15s}
.tip:hover{background:rgba(255,255,255,.12);color:var(--muted)}
.tip-box{display:none;position:absolute;bottom:calc(100% + 10px);left:50%;transform:translateX(-50%);width:280px;padding:12px 14px;border-radius:11px;background:#1a2438;border:1px solid rgba(255,255,255,.1);color:var(--text);font-size:12px;line-height:1.55;font-weight:400;z-index:100;box-shadow:0 10px 30px rgba(0,0,0,.6)}
.tip-box::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:7px solid transparent;border-top-color:#1a2438}
.tip.open .tip-box{display:block}.tip.open{background:rgba(96,165,250,.2);color:var(--blue)}
@media(max-width:740px){.tip-box{left:auto;right:-10px;transform:none;width:250px}.tip-box::after{left:auto;right:16px;transform:none}}
.chdr{display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none;padding:5px 0}
.chdr .ar{font-size:9px;color:var(--dim);transition:transform .2s}.chdr.open .ar{transform:rotate(180deg)}
.cbody{max-height:0;overflow:hidden;transition:max-height .3s,opacity .2s;opacity:0}.cbody.open{max-height:800px;opacity:1}
.col-r .card{position:sticky;top:12px}
.status{display:inline-flex;align-items:center;gap:7px;padding:6px 14px;border-radius:999px;font-size:12px;font-weight:600;border:1px solid var(--line)}
.status .dot{width:8px;height:8px;border-radius:50%}
.status.ok{background:var(--green-dim);border-color:rgba(52,211,153,.25);color:var(--green)}.status.ok .dot{background:var(--green)}
.status.warn{background:var(--amber-dim);border-color:rgba(251,191,36,.25);color:var(--amber)}.status.warn .dot{background:var(--amber)}
.status.danger{background:var(--red-dim);border-color:rgba(248,113,113,.25);color:var(--red)}.status.danger .dot{background:var(--red)}
.kpis{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.kpi{background:rgba(255,255,255,.025);border:1px solid var(--line);border-radius:11px;padding:11px 12px}
.kpi .t{font-size:10.5px;color:var(--muted);margin-bottom:2px}.kpi .n{font-size:20px;font-weight:800;font-family:'JetBrains Mono',monospace;letter-spacing:-.4px}
.kpi .s{font-size:9.5px;color:var(--dim);margin-top:2px}
.kpi.hero{grid-column:1/-1;background:var(--sun-dim);border-color:rgba(245,197,66,.15)}.kpi.hero .n{color:var(--sun)}
.chwrap{margin-top:10px}.chlbl{font-size:10px;color:var(--muted);margin-bottom:5px;font-weight:600;text-transform:uppercase;letter-spacing:.4px}
.legend-row{display:flex;gap:12px;margin-top:4px}.legend-row span{font-size:9.5px;display:flex;align-items:center;gap:3px}.ldot{width:10px;height:5px;border-radius:1px}
.sbar{display:flex;height:22px;border-radius:6px;overflow:hidden;margin-top:5px}.sseg{display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:var(--bg);transition:width .3s;min-width:30px}
.roi{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;margin-top:7px}@media(max-width:500px){.roi{grid-template-columns:1fr 1fr}}
.roi-i{text-align:center;padding:9px 5px;border-radius:9px;border:1px solid var(--line);background:rgba(255,255,255,.015)}
.roi-i .rn{font-size:16px;font-weight:800;font-family:'JetBrains Mono',monospace;color:var(--green)}.roi-i .rt{font-size:9.5px;color:var(--muted);margin-top:1px}
.note{margin-top:8px;padding:8px 10px;border-radius:9px;border:1px solid var(--line);background:rgba(255,255,255,.015);font-size:10.5px;color:var(--muted);line-height:1.5}
.note.info{border-color:rgba(96,165,250,.15);background:rgba(96,165,250,.03);color:var(--blue)}
.mdetail{margin-top:6px;padding:10px 12px;border-radius:10px;background:rgba(245,197,66,.04);border:1px solid rgba(245,197,66,.1);font-size:11px;line-height:1.7;display:none}
.mdetail.show{display:block}
.mdetail .md-title{font-weight:700;color:var(--sun);margin-bottom:3px;display:flex;justify-content:space-between;align-items:center}
.mdetail .md-close{cursor:pointer;color:var(--dim);font-size:14px}
.mdetail .md-row{display:flex;justify-content:space-between;color:var(--muted)}
.mdetail .md-row .md-v{color:var(--text);font-family:'JetBrains Mono',monospace;font-size:11px}
.chart-bar-col{cursor:pointer;transition:opacity .15s}.chart-bar-col:hover{opacity:.85}
footer{margin-top:20px;padding:14px 0;border-top:1px solid var(--line);text-align:center;font-size:10px;color:var(--dim)}footer a{color:var(--blue);text-decoration:none}
</style></head><body><div class="wrap">
<header>
  <div class="logo"><div class="logo-icon">‚òÄ</div><div><h1 data-t="title">PV –ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä ‚Äî –ë—ä–ª–≥–∞—Ä–∏—è</h1><div class="sub" data-t="subtitle">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ ¬∑ –ö–æ–Ω—Å—É–º–∞—Ü–∏—è ¬∑ –ë–∞—Ç–µ—Ä–∏—è ¬∑ –í—ä–∑–≤—Ä—ä—â–∞–µ–º–æ—Å—Ç</div></div></div>
  <div class="hdr-btns"><button class="reset-btn" onclick="resetAll()" data-t="btn_reset">‚Ü∫ –ù—É–ª–∏—Ä–∞–Ω–µ</button>
    <div class="lang-toggle"><button class="lang-btn active" data-lang="bg"><svg width="20" height="14" viewBox="0 0 20 14"><rect width="20" height="4.67" fill="#fff"/><rect y="4.67" width="20" height="4.67" fill="#00966E"/><rect y="9.33" width="20" height="4.67" fill="#D62612"/></svg> BG</button><button class="lang-btn" data-lang="en"><svg width="20" height="14" viewBox="0 0 20 14"><rect fill="#012169" width="20" height="14"/><path d="M0,0L20,14M20,0L0,14" stroke="#fff" stroke-width="2.5"/><path d="M0,0L20,14M20,0L0,14" stroke="#C8102E" stroke-width="1.3"/><path d="M10,0V14M0,7H20" stroke="#fff" stroke-width="4"/><path d="M10,0V14M0,7H20" stroke="#C8102E" stroke-width="2.2"/></svg> EN</button></div></div>
</header>
<div class="grid3">
<!-- –ö–û–õ–û–ù–ê 1: –°–ò–°–¢–ï–ú–ê + –û–†–ò–ï–ù–¢–ê–¶–ò–Ø -->
<div class="card">
  <div class="sec"><div class="stitle" data-t="s_system">–°–∏—Å—Ç–µ–º–∞</div>
    <div class="fld"><div class="flbl" data-t="l_type">–¢–∏–ø –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è</div><select id="mode"><option value="roof" data-t="o_roof">–ü–æ–∫—Ä–∏–≤ / –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</option><option value="fence" data-t="o_fence">–°–æ–ª–∞—Ä–Ω–∞ –æ–≥—Ä–∞–¥–∞</option></select></div>
    <div class="fld"><div class="frow"><span class="flbl" data-t="l_area">–ü–ª–æ—â –∑–∞ –ø–∞–Ω–µ–ª–∏</span><span class="fval" id="areaV">50 m¬≤</span></div><div class="szone"><input id="area" type="range" min="5" max="300" step="1" value="50"/></div><div class="fhint"><span>5 m¬≤</span><span>300 m¬≤</span></div></div>
    <div class="fcomp" id="kwpV">10.0 kWp</div>
    <div class="fsmall" data-t="kwp_hint">‚âà 200 W/m¬≤ ¬∑ –º–æ–¥–µ—Ä–Ω–∏ –ø–∞–Ω–µ–ª–∏ 400‚Äì550 W ¬∑ 1 –ø–∞–Ω–µ–ª ‚âà 2 m¬≤</div></div>
  <div class="sec" id="roofBlock"><div class="stitle" data-t="s_orient">–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –ø–∞–Ω–µ–ª–∏—Ç–µ</div>
    <div class="flbl" style="margin-bottom:5px" data-t="l_auto">–ë—ä—Ä–∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_auto">–ó–∞–¥–∞–≤–∞ –æ–ø—Ç–∏–º–∞–ª–µ–Ω –∞–∑–∏–º—É—Ç –∏ –Ω–∞–∫–ª–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</div></span></div>
    <div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:7px" id="presetBar"><button class="pbtn" data-p="manual"><span>‚úé</span> <span data-t="p_manual">–†—ä—á–Ω–æ</span></button><button class="pbtn on" data-p="annual"><span>‚óé</span> <span data-t="p_annual">–ì–æ–¥–∏—à–µ–Ω</span></button><button class="pbtn" data-p="summer"><span>‚òÄ</span> <span data-t="p_summer">–õ—è—Ç–æ</span></button><button class="pbtn" data-p="winter"><span>‚ùÑ</span> <span data-t="p_winter">–ó–∏–º–∞</span></button><button class="pbtn" data-p="equinox"><span>‚öñ</span> <span data-t="p_equinox">–†–∞–≤–Ω–æ–¥–µ–Ω—Å—Ç–≤–∏–µ</span></button></div>
    <div class="note info" id="presetNote" style="margin-bottom:7px;font-size:10px"></div>
    <div class="fld"><div class="frow"><span class="flbl" data-t="l_azimuth">–ê–∑–∏–º—É—Ç (–ø–æ—Å–æ–∫–∞)</span><span class="fval" id="azV">180¬∞ –Æ–≥</span></div>
      <div class="pills" id="azBtns"><button class="pill" data-az="90">–ò–∑—Ç–æ–∫ 90¬∞</button><button class="pill" data-az="135">–Æ–≥–æ–∏–∑—Ç–æ–∫ 135¬∞</button><button class="pill on" data-az="180" data-t="az_s">–Æ–≥ 180¬∞</button><button class="pill" data-az="210">–Æ–≥–æ–∑–∞–ø–∞–¥ 210¬∞</button><button class="pill" data-az="270">–ó–∞–ø–∞–¥ 270¬∞</button></div></div>
    <div class="fld"><div class="frow"><span class="flbl" data-t="l_tilt">–ù–∞–∫–ª–æ–Ω –Ω–∞ –ø–∞–Ω–µ–ª–∏—Ç–µ <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_tilt">0¬∞ = —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–Ω–æ. 90¬∞ = —Å—Ç–µ–Ω–∞. –ó–∞ –ë—ä–ª–≥–∞—Ä–∏—è –æ–ø—Ç–∏–º–∞–ª–Ω–æ 35‚Äì38¬∞.</div></span></span><span class="fval" id="tiltV">36¬∞</span></div><div class="szone"><input id="tilt" type="range" min="0" max="90" step="1" value="36"/></div><div class="fhint"><span>0¬∞ –ø–ª–æ—Å—ä–∫</span><span>36¬∞ –æ–ø—Ç–∏–º–∞–ª–µ–Ω</span><span>90¬∞ —Å—Ç–µ–Ω–∞</span></div></div>
    <div style="margin-top:5px"><div class="chdr" id="str2Hdr" onclick="toggleStr2()"><span class="flbl" style="font-weight:600" data-t="l_str2">Ôºã –í—Ç–æ—Ä–∏ —Å—Ç—Ä–∏–Ω–≥ (–≤—Ç–æ—Ä–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)</span><span class="ar">‚ñº</span></div>
    <div class="cbody" id="str2B">
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_share">–î—è–ª –æ—Ç –æ–±—â–∞—Ç–∞ –º–æ—â–Ω–æ—Å—Ç</span><span class="fval" id="s2sV">30%</span></div><div class="szone"><input id="s2s" type="range" min="10" max="60" step="1" value="30"/></div></div>
      <div class="fld"><div class="flbl" style="margin-bottom:4px" data-t="l_az2">–ê–∑–∏–º—É—Ç –Ω–∞ —Å—Ç—Ä–∏–Ω–≥ 2</div><div class="pills" id="az2Btns"><button class="pill" data-az2="90">–ò–∑—Ç–æ–∫</button><button class="pill" data-az2="150">–Æ–≥–æ–∏–∑—Ç–æ–∫</button><button class="pill on" data-az2="270">–ó–∞–ø–∞–¥</button></div></div>
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_tilt2">–ù–∞–∫–ª–æ–Ω –Ω–∞ —Å—Ç—Ä–∏–Ω–≥ 2</span><span class="fval" id="t2V">36¬∞</span></div><div class="szone"><input id="t2" type="range" min="0" max="90" step="1" value="36"/></div></div>
    </div></div></div>
  <div class="sec" id="fenceBlock" style="display:none"><div class="stitle" data-t="s_fence_or">–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –æ–≥—Ä–∞–¥–∞—Ç–∞</div>
    <div class="fld"><div class="flbl" style="margin-bottom:4px" data-t="l_fence_dir">–ü–æ—Å–æ–∫–∞ –Ω–∞ –æ–≥—Ä–∞–¥–∞—Ç–∞</div><div class="pills" id="fenceBtns"><button class="pill on" data-f="S">–Æ–≥</button><button class="pill" data-f="EW">–ò–∑—Ç–æ–∫‚Äì–ó–∞–ø–∞–¥</button><button class="pill" data-f="SESW">–Æ–≥–æ–∏–∑—Ç–æ–∫+–Æ–≥–æ–∑–∞–ø–∞–¥</button><button class="pill" data-f="ALL" data-t="f_all">–í—Å–∏—á–∫–∏ –ø–æ—Å–æ–∫–∏</button></div></div>
    <div class="fld"><div class="frow"><span class="flbl">–î–≤—É—Å—Ç—Ä–∞–Ω–Ω–∏ –ø–∞–Ω–µ–ª–∏ (bifacial) <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_bifacial">–ü—Ä–æ–∏–∑–≤–µ–∂–¥–∞—Ç –∏ –æ—Ç –∑–∞–¥–Ω–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞. 5‚Äì25% –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–æ.</div></span></span><span class="fval" id="bifV">10%</span></div><div class="szone"><input id="bif" type="range" min="0" max="30" step="1" value="10"/></div></div></div>
  <div class="sec"><div class="stitle" data-t="s_losses">–°–∏—Å—Ç–µ–º–Ω–∏ –∑–∞–≥—É–±–∏ <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_losses">–ò–Ω–≤–µ—Ä—Ç–æ—Ä + –∫–∞–±–µ–ª–∏ + —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ + –∑–∞–º—ä—Ä—Å—è–≤–∞–Ω–µ. 12‚Äì16% –Ω–æ—Ä–º–∞–ª–Ω–æ.</div></span></div>
    <div class="fld"><div class="frow"><span class="flbl" data-t="l_sysloss">–ö–∞–±–µ–ª–∏, –∏–Ω–≤–µ—Ä—Ç–æ—Ä, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span><span class="fval" id="slV">14.0%</span></div><div class="szone"><input id="sl" type="range" min="8" max="25" step="0.5" value="14"/></div><div class="fhint"><span>8% –ø—Ä–µ–º–∏—É–º</span><span>14% —Ç–∏–ø–∏—á–Ω–æ</span><span>25% —Å—Ç–∞—Ä–∞</span></div></div></div>
</div>
<!-- –ö–û–õ–û–ù–ê 2: –õ–û–ö–ê–¶–ò–Ø + –ö–û–ù–°–£–ú–ê–¶–ò–Ø + –§–ò–ù–ê–ù–°–ò -->
<div class="card">
  <div class="sec"><div class="stitle" data-t="s_location">–°–ª—ä–Ω—á–µ–≤–∞ —Ä–∞–¥–∏–∞—Ü–∏—è –∏ –∑–∞—Å–µ–Ω—á–≤–∞–Ω–µ</div>
    <div class="fld"><div class="frow"><span class="flbl" data-t="l_irr">–°–ª—ä–Ω—á–µ–≤–∞ —Ä–∞–¥–∏–∞—Ü–∏—è <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_irr">kWh/m¬≤/–¥–µ–Ω —Å—Ä–µ–¥–Ω–æ–≥–æ–¥–∏—à–Ω–æ. –°–æ—Ñ–∏—è‚âà3.8, –ë—É—Ä–≥–∞—Å‚âà4.0, –°–∞–Ω–¥–∞–Ω—Å–∫–∏‚âà4.2. –ú—é–Ω—Ö–µ–Ω‚âà3.4, –ë–µ—Ä–ª–∏–Ω‚âà3.0. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –≤ PVGIS.</div></span></span><span class="fval" id="irrV">3.90</span></div><div class="szone"><input id="irr" type="range" min="2.50" max="5.00" step="0.01" value="3.90"/></div><div class="fhint"><span>2.50 <span data-t="h_north">–°–µ–≤–µ—Ä–Ω–∞ –ï–≤—Ä–æ–ø–∞</span></span><span>3.90</span><span>5.00 <span data-t="h_south">–Æ–∂–Ω–∞ –ï–≤—Ä–æ–ø–∞</span></span></div></div>
    <div class="fld"><div class="frow"><span class="flbl" data-t="l_micro">–ú–∏–∫—Ä–æ–∫–ª–∏–º–∞—Ç <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_micro">–ü–ª–∞–Ω–∏–Ω—Å–∫–∏: +10‚Äì20%. –°–º–æ–≥/–º—ä–≥–ª–∞: ‚àí10‚Äì20%.</div></span></span><span class="fval" id="micV">0%</span></div><div class="szone"><input id="mic" type="range" min="-20" max="20" step="1" value="0"/></div><div class="fhint"><span data-t="h_smog">‚àí20% —Å–º–æ–≥</span><span data-t="h_mountain">+20% –ø–ª–∞–Ω–∏–Ω—Å–∫–∏</span></div></div>
    <div class="split">
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_shadefar">–î–∞–ª–µ—á–Ω–æ –∑–∞—Å–µ–Ω—á–≤–∞–Ω–µ <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–ü–ª–∞–Ω–∏–Ω–∏ –Ω–∞ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞. –†–∞–≤–Ω–∏–Ω–∞: 0%. –î–æ–ª–∏–Ω–∞: 5‚Äì15%.</div></span></span><span class="fval" id="sfV">0%</span></div><div class="szone"><input id="sf" type="range" min="0" max="15" step="1" value="0"/></div></div>
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_shadenear">–ë–ª–∏–∑–∫–æ –∑–∞—Å–µ–Ω—á–≤–∞–Ω–µ <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–î—ä—Ä–≤–µ—Ç–∞, —Å–≥—Ä–∞–¥–∏. –ù–∞–¥ 10%: –æ–±–º–∏—Å–ª–µ—Ç–µ. –ù–∞–¥ 25%: –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–æ!</div></span></span><span class="fval" id="snV">0%</span></div><div class="szone"><input id="sn" type="range" min="0" max="40" step="1" value="0"/></div></div></div></div>
  <div class="sec"><div class="stitle" data-t="s_consumption">–ú–µ—Å–µ—á–Ω–∞ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥–∏—è <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_consumption">–†–∞–∑–¥–µ–ª–µ—Ç–µ –Ω–∞ 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: –±–∏—Ç–æ–≤–∞ (–ø–æ—Å—Ç–æ—è–Ω–Ω–∞), –µ–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª (–ø–æ—Å—Ç–æ—è–Ω–µ–Ω) –∏ –æ—Ç–æ–ø–ª–µ–Ω–∏–µ/–æ—Ö–ª–∞–∂–¥–∞–Ω–µ (—Å–µ–∑–æ–Ω–Ω–æ ‚Äî –∫–∞–º–±–∞–Ω–∞).</div></span></div>
    <div class="fld"><div class="frow"><span class="flbl">üè† –ë–∏—Ç–æ–≤–∞ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è (—Ü–µ–ª–æ–≥–æ–¥–∏—à–Ω–æ) <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–û—Å–≤–µ—Ç–ª–µ–Ω–∏–µ, —Ö–ª–∞–¥–∏–ª–Ω–∏–∫, –ø–µ—Ä–∞–ª–Ω—è, –≥–æ—Ç–≤–µ–Ω–µ, –∫–æ–º–ø—é—Ç—Ä–∏. –ü–æ—Å—Ç–æ—è–Ω–Ω–∞ —Ü–µ–ª–æ–≥–æ–¥–∏—à–Ω–æ. –¢–∏–ø–∏—á–Ω–æ: 150‚Äì400 kWh/–º–µ—Å–µ—Ü.</div></span></span><span class="fval" id="conHV">250 kWh/–º–µ—Å–µ—Ü</span></div><div class="szone big"><input id="conH" type="range" min="50" max="1500" step="10" value="250"/></div><div class="fhint"><span>50</span><span>250</span><span>1 500 kWh</span></div></div>
    <div class="fld"><div class="frow"><span class="flbl">üöó –ï–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª (—Ü–µ–ª–æ–≥–æ–¥–∏—à–Ω–æ) <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–°—Ä–µ–¥–Ω–∞ –º–µ—Å–µ—á–Ω–∞ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ. –ü–æ—Å—Ç–æ—è–Ω–Ω–∞ —Ü–µ–ª–æ–≥–æ–¥–∏—à–Ω–æ. 0 = –Ω—è–º–∞–º EV. –¢–∏–ø–∏—á–Ω–æ 300‚Äì800 kWh/–º–µ—Å. EV —É–≤–µ–ª–∏—á–∞–≤–∞ —Å–∞–º–æ–∫–æ–Ω—Å—É–º–∞—Ü–∏—è—Ç–∞ ‚Äî –∫–æ–ª–∞—Ç–∞ –¥–µ–π—Å—Ç–≤–∞ –∫–∞—Ç–æ –±–∞—Ç–µ—Ä–∏—è.</div></span></span><span class="fval" id="conEVV">0 kWh/–º–µ—Å–µ—Ü</span></div><div class="szone big"><input id="conEV" type="range" min="0" max="1500" step="10" value="0"/></div><div class="fhint"><span>0 = –±–µ–∑ EV</span><span>500</span><span>1 500 kWh</span></div></div>
    <div class="fld"><div class="frow"><span class="flbl">üî• –û—Ç–æ–ø–ª–µ–Ω–∏–µ/–æ—Ö–ª–∞–∂–¥–∞–Ω–µ (–ø–∏–∫–æ–≤–æ –∑–∏–º–Ω–æ) <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–ú–∞–∫—Å–∏–º–∞–ª–Ω–∞—Ç–∞ –º–µ—Å–µ—á–Ω–∞ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è –∑–∞ –æ—Ç–æ–ø–ª–µ–Ω–∏–µ (–¥–µ–∫–µ–º–≤—Ä–∏‚Äì—Ñ–µ–≤—Ä—É–∞—Ä–∏). –õ—è—Ç–æ—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–∞–¥–∞ –¥–æ –º–∏–Ω–∏–º—É–º –∑–∞ –æ—Ö–ª–∞–∂–¥–∞–Ω–µ (~200 kWh). –ü—Ä–æ–ª–µ—Ç/–µ—Å–µ–Ω ‚Äî —Å—Ä–µ–¥–Ω–æ. –ö–∞–º–±–∞–Ω–æ–≤–∏–¥–Ω–∞ –∫—Ä–∏–≤–∞.</div></span></span><span class="fval" id="conHeatV">0 kWh/–º–µ—Å–µ—Ü</span></div><div class="szone big"><input id="conHeat" type="range" min="0" max="3000" step="10" value="0"/></div><div class="fhint"><span>0 = –±–µ–∑ –æ—Ç–æ–ø–ª–µ–Ω–∏–µ</span><span>800</span><span>3 000 kWh</span></div></div>
    <div class="fcomp" id="conYV">3 000 kWh/–≥–æ–¥–∏–Ω–∞</div>
    <div class="fld"><div class="frow"><span class="flbl" data-t="l_selfcon">–°–∞–º–æ–∫–æ–Ω—Å—É–º–∞—Ü–∏—è <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_selfcon">–ö–∞–∫–≤–∞ —á–∞—Å—Ç –æ—Ç —Å–æ–ª–∞—Ä–∞ –ø–æ–ª–∑–≤–∞—Ç–µ –¥–∏—Ä–µ–∫—Ç–Ω–æ. –ú–∞–∫—Å–∏–º—É–º—ä—Ç –∑–∞–≤–∏—Å–∏ –æ—Ç EV –∏ –±–∞—Ç–µ—Ä–∏—è. –ë–µ–∑ –Ω–∏—â–æ: 50%. –° EV: 75%. –° –±–∞—Ç–µ—Ä–∏—è: 90%. –° –¥–≤–µ—Ç–µ: 95%.</div></span></span><span class="fval" id="scV">30%</span></div><div class="szone"><input id="sc" type="range" min="10" max="50" step="1" value="30"/></div><div class="fhint"><span>10% —Ä—è–¥–∫–æ –≤–∫—ä—â–∏</span><span id="scMaxHint">–º–∞–∫—Å–∏–º—É–º 50%</span></div></div>
    <div class="split">
      <div class="fld"><div class="flbl" data-t="l_battery">–ë–∞—Ç–µ—Ä–∏—è –∑–∞ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ <span class="tip" onclick="toggleTip(this)">?<div class="tip-box" data-t="tip_battery">–°—ä—Ö—Ä–∞–Ω—è–≤–∞ –¥–Ω–µ–≤–Ω–∏—è –∏–∑–ª–∏—à—ä–∫ –∑–∞ –Ω–æ—â—Ç–∞. –ù–∞–º–∞–ª—è–≤–∞ –∑–∞–≥—É–±–µ–Ω–∏—è —Ç–æ–∫.</div></span></div><select id="bat"><option value="0" data-t="o_nobat">–ë–µ–∑ –±–∞—Ç–µ—Ä–∏—è</option><option value="5">5 kWh</option><option value="10">10 kWh</option><option value="15">15 kWh</option><option value="20">20 kWh</option><option value="30">30 kWh</option><option value="40">40 kWh</option><option value="50">50 kWh</option></select></div>
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_batcost">–¶–µ–Ω–∞ –Ω–∞ –±–∞—Ç–µ—Ä–∏—è—Ç–∞ (–æ–±—â–∞) <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">5kWh‚âà1500‚Äì2500‚Ç¨, 10kWh‚âà3000‚Äì4500‚Ç¨, 30kWh‚âà8000‚Äì12000‚Ç¨.</div></span></span><span class="fval" id="bcV">3 500 ‚Ç¨</span></div><div class="szone"><input id="bc" type="range" min="0" max="25000" step="100" value="3500"/></div><div class="fhint"><span>0 ‚Ç¨</span><span>25 000 ‚Ç¨</span></div></div></div></div>
  <div class="sec"><div class="stitle" data-t="s_finance">–§–∏–Ω–∞–Ω—Å–æ–≤–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</div>
    <div class="split">
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_buyprice">–¶–µ–Ω–∞ –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥–∏—è—Ç–∞ <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–û—Ç —Å–º–µ—Ç–∫–∞—Ç–∞. –ë—ä–ª–≥–∞—Ä–∏—è: 0.12‚Äì0.15 ‚Ç¨/kWh. –ì–µ—Ä–º–∞–Ω–∏—è: 0.30‚Äì0.40 ‚Ç¨/kWh.</div></span></span><span class="fval" id="prV">0.150 ‚Ç¨/kWh</span></div><div class="szone"><input id="pr" type="range" min="0.06" max="0.50" step="0.005" value="0.15"/></div></div>
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_feedin">–ò–∑–∫—É–ø–Ω–∞ —Ü–µ–Ω–∞ –Ω–∞ –∏–∑–ª–∏—à—ä–∫–∞ <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–° –¥–æ–≥–æ–≤–æ—Ä: 0.04‚Äì0.08 ‚Ç¨/kWh. –ë–µ–∑ –¥–æ–≥–æ–≤–æ—Ä: 0 ‚Ç¨ ‚Äî —Ç–æ–∫—ä—Ç —Å–µ –≥—É–±–∏.</div></span></span><span class="fval" id="fiV">0.000 ‚Ç¨/kWh</span></div><div class="szone"><input id="fi" type="range" min="0" max="0.15" step="0.005" value="0"/></div></div></div>
    <div class="fld"><div class="frow"><span class="flbl" data-t="l_syscost">–¶–µ–Ω–∞ –Ω–∞ —Å–æ–ª–∞—Ä–Ω–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ (–æ–±—â–∞) <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–° –º–æ–Ω—Ç–∞–∂, –±–µ–∑ –±–∞—Ç–µ—Ä–∏—è. 5kWp‚âà4‚Äì6k‚Ç¨, 10kWp‚âà7‚Äì11k‚Ç¨, 20kWp‚âà14‚Äì20k‚Ç¨.</div></span></span><span class="fval" id="sc2V">9 000 ‚Ç¨</span></div><div class="szone"><input id="sc2" type="range" min="2000" max="50000" step="100" value="9000"/></div><div class="fhint"><span>2 000 ‚Ç¨</span><span>50 000 ‚Ç¨</span></div></div>
    <div class="fsmall" id="sc2hint">= 900 ‚Ç¨/kWp</div>
    <div class="split">
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_subsidy">–°—É–±—Å–∏–¥–∏—è –∏–ª–∏ –≥—Ä–∞–Ω—Ç</span><span class="fval" id="subV">0 ‚Ç¨</span></div><div class="szone"><input id="sub" type="range" min="0" max="20000" step="100" value="0"/></div></div>
      <div class="fld"><div class="frow"><span class="flbl" data-t="l_escalation">–ì–æ–¥–∏—à–Ω–æ –ø–æ—Å–∫—ä–ø–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫–∞ <span class="tip" onclick="toggleTip(this)">?<div class="tip-box">–ï–°: 3‚Äì5%/–≥–æ–¥–∏–Ω–∞. –ü–æ-–≤–∏—Å–æ–∫–æ = –ø–æ-–±—ä—Ä–∑–∞ –≤—ä–∑–≤—Ä—ä—â–∞–µ–º–æ—Å—Ç.</div></span></span><span class="fval" id="escV">3%</span></div><div class="szone"><input id="esc" type="range" min="0" max="8" step="0.5" value="3"/></div></div></div></div>
</div>
<!-- –ö–û–õ–û–ù–ê 3: –†–ï–ó–£–õ–¢–ê–¢–ò -->
<div class="col-r"><div class="card">
  <div id="statusPill" class="status ok"><span class="dot"></span><span id="statusText">–î–æ–±—Ä–∏ —É—Å–ª–æ–≤–∏—è</span></div>
  <div class="kpis" style="margin-top:8px"><div class="kpi hero"><div class="t" data-t="r_annual">–ì–æ–¥–∏—à–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</div><div class="n" id="oYear">‚Äî</div><div class="s" id="oYearN">‚Äî</div></div></div>
  <div class="kpis"><div class="kpi"><div class="t" data-t="r_selfcon">–°–∞–º–æ–∫–æ–Ω—Å—É–º–∏—Ä–∞–Ω–æ</div><div class="n" id="oSelf">‚Äî</div><div class="s" id="oSelfN">‚Äî</div></div><div class="kpi"><div class="t" id="expTitle" data-t="r_export">–ü—Ä–æ–¥–∞–¥–µ–Ω–æ</div><div class="n" id="oExp">‚Äî</div><div class="s" id="oExpN">‚Äî</div></div></div>
  <div class="kpis"><div class="kpi"><div class="t" id="dayTitle">–î–Ω–µ–≤–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</div><div class="n" id="oDay">‚Äî</div></div><div class="kpi"><div class="t" data-t="r_loss">–û–±—â–∏ –∑–∞–≥—É–±–∏</div><div class="n" id="oLoss">‚Äî</div><div class="s" id="oLossDetail">‚Äî</div></div></div>
  <!-- CHART -->
  <div class="chwrap" style="margin-top:14px"><div class="chlbl" style="font-size:11.5px" data-t="r_chart">‚ö° –ú–µ—Å–µ—á–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —Å–ø—Ä—è–º–æ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è</div>
    <div id="chart" style="display:grid;grid-template-columns:repeat(12,1fr);gap:3px;align-items:end;height:200px;background:rgba(255,255,255,.02);border-radius:10px;padding:8px 5px 0"></div>
    <div class="legend-row" style="margin-top:5px"><span><span class="ldot" style="background:var(--sun)"></span> <span data-t="lg_prod">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</span></span><span><span class="ldot" style="background:var(--cyan)"></span> <span data-t="lg_cons">–ö–æ–Ω—Å—É–º–∞—Ü–∏—è</span></span><span style="margin-left:auto;font-size:8px;color:var(--dim)" data-t="lg_click">‚Üê –∫–ª–∏–∫–Ω–µ—Ç–µ –±–∞—Ä –∑–∞ –¥–µ—Ç–∞–π–ª–∏</span></div></div>
  <div class="mdetail" id="mdetail"></div>
  <!-- Savings -->
  <div class="chwrap"><div class="chlbl" data-t="r_savings">–ì–æ–¥–∏—à–Ω–∏ —Å–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è</div><div class="sbar"><div class="sseg" id="segS" style="background:var(--green);width:60%">0 ‚Ç¨</div><div class="sseg" id="segF" style="background:var(--blue);width:40%">0 ‚Ç¨</div></div>
    <div class="legend-row"><span><span class="ldot" style="background:var(--green)"></span> <span data-t="lg_saved">–°–ø–µ—Å—Ç–µ–Ω —Ç–æ–∫</span></span><span><span class="ldot" style="background:var(--blue)"></span> <span data-t="lg_sold">–ò–∑–∫—É–ø–µ–Ω —Ç–æ–∫</span></span></div></div>
  <!-- ROI -->
  <div class="chwrap"><div class="chlbl" data-t="r_roi">–í—ä–∑–≤—Ä—ä—â–∞–µ–º–æ—Å—Ç –∑–∞ 25 –≥–æ–¥–∏–Ω–∏</div><div class="roi">
    <div class="roi-i"><div class="rn" id="riC">‚Äî</div><div class="rt" data-t="ri_invest">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è</div></div><div class="roi-i"><div class="rn" id="riP">‚Äî</div><div class="rt" data-t="ri_payback">–ò–∑–ø–ª–∞—â–∞–Ω–µ</div></div>
    <div class="roi-i"><div class="rn" id="riR">‚Äî</div><div class="rt" data-t="ri_profit">–ü–µ—á–∞–ª–±–∞</div></div><div class="roi-i"><div class="rn" id="riCO">‚Äî</div><div class="rt">CO‚ÇÇ —Å–ø–µ—Å—Ç–µ–Ω</div></div></div></div>
  <div class="note" data-t="r_note">–í–∫–ª—é—á–≤–∞ 0.5% –≥–æ–¥–∏—à–Ω–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è, 3-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è —Å –∫–∞–º–±–∞–Ω–∞ –∑–∞ –æ—Ç–æ–ø–ª–µ–Ω–∏–µ, CO‚ÇÇ 0.45 kg/kWh (–ë–ì –º–∏–∫—Å).</div>
</div></div></div>
<footer>PV –ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä v12 ¬∑ <a href="https://re.jrc.ec.europa.eu/pvg_tools/en/" target="_blank">PVGIS</a></footer></div>
<script>
var $=function(id){return document.getElementById(id)};
var MN=['','–Ø–Ω','–§–µ–≤','–ú–∞—Ä','–ê–ø—Ä','–ú–∞–π','–Æ–Ω–∏','–Æ–ª–∏','–ê–≤–≥','–°–µ–ø','–û–∫—Ç','–ù–æ–µ','–î–µ–∫'];
var MNF=['','–Ø–Ω—É–∞—Ä–∏','–§–µ–≤—Ä—É–∞—Ä–∏','–ú–∞—Ä—Ç','–ê–ø—Ä–∏–ª','–ú–∞–π','–Æ–Ω–∏','–Æ–ª–∏','–ê–≤–≥—É—Å—Ç','–°–µ–ø—Ç–µ–º–≤—Ä–∏','–û–∫—Ç–æ–º–≤—Ä–∏','–ù–æ–µ–º–≤—Ä–∏','–î–µ–∫–µ–º–≤—Ä–∏'];
var MNE=['','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
var MNEF=['','January','February','March','April','May','June','July','August','September','October','November','December'];
var DIM=[0,31,28,31,30,31,30,31,31,30,31,30,31];
// Monthly solar factors (relative to annual avg)
var MF=[0,.46,.55,.82,1.05,1.19,1.38,1.42,1.30,1.05,.76,.50,.42];
// Optimal tilt per month
var OT=[0,60,55,45,35,28,25,27,33,42,52,58,61];
// Heating bell curve: Jan=1.0(peak), Jul=0.17(min AC), normalized so peak=1.0
var HB=[0,1.0,.95,.55,.25,.17,.17,.17,.17,.25,.55,.85,1.0];
var FK={S:.55,EW:.48,SESW:.52,ALL:.42};
var PRS={annual:{az:180,tilt:36},summer:{az:180,tilt:15},winter:{az:195,tilt:60},equinox:{az:180,tilt:42}};
var DEFS={bg:{irr:3.90,mic:0,sl:14,pr:0.15,fi:0,sc2:9000,sub:0,esc:3,bc:3500,conH:250,conEV:0,conHeat:0},en:{irr:3.20,mic:0,sl:14,pr:0.35,fi:0.08,sc2:14000,sub:0,esc:3,bc:4000,conH:300,conEV:0,conHeat:0}};
var lang='bg',selM=0,az1=180,az2=270,fDir='S',str2=false,preset='annual';
var mP=[],mC=[]; // stored for click handler

var T={title:{bg:'PV –ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä ‚Äî –ë—ä–ª–≥–∞—Ä–∏—è',en:'PV Calculator ‚Äî Germany'},subtitle:{bg:'–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ ¬∑ –ö–æ–Ω—Å—É–º–∞—Ü–∏—è ¬∑ –ë–∞—Ç–µ—Ä–∏—è ¬∑ –í—ä–∑–≤—Ä—ä—â–∞–µ–º–æ—Å—Ç',en:'Production ¬∑ Consumption ¬∑ Battery ¬∑ ROI'},btn_reset:{bg:'‚Ü∫ –ù—É–ª–∏—Ä–∞–Ω–µ',en:'‚Ü∫ Reset'},s_system:{bg:'–°–∏—Å—Ç–µ–º–∞',en:'System'},l_type:{bg:'–¢–∏–ø –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è',en:'Installation type'},o_roof:{bg:'–ü–æ–∫—Ä–∏–≤ / –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è',en:'Roof / structure'},o_fence:{bg:'–°–æ–ª–∞—Ä–Ω–∞ –æ–≥—Ä–∞–¥–∞',en:'Solar fence'},l_area:{bg:'–ü–ª–æ—â –∑–∞ –ø–∞–Ω–µ–ª–∏',en:'Panel area'},kwp_hint:{bg:'‚âà 200 W/m¬≤ ¬∑ –º–æ–¥–µ—Ä–Ω–∏ –ø–∞–Ω–µ–ª–∏ 400‚Äì550 W ¬∑ 1 –ø–∞–Ω–µ–ª ‚âà 2 m¬≤',en:'‚âà 200 W/m¬≤ ¬∑ modern panels 400‚Äì550 W ¬∑ 1 panel ‚âà 2 m¬≤'},s_orient:{bg:'–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –ø–∞–Ω–µ–ª–∏—Ç–µ',en:'Panel orientation'},l_auto:{bg:'–ë—ä—Ä–∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è',en:'Quick optimize'},tip_auto:{bg:'–ó–∞–¥–∞–≤–∞ –æ–ø—Ç–∏–º–∞–ª–µ–Ω –∞–∑–∏–º—É—Ç –∏ –Ω–∞–∫–ª–æ–Ω.',en:'Sets optimal azimuth and tilt.'},p_manual:{bg:'–†—ä—á–Ω–æ',en:'Manual'},p_annual:{bg:'–ì–æ–¥–∏—à–µ–Ω',en:'Annual'},p_summer:{bg:'–õ—è—Ç–æ',en:'Summer'},p_winter:{bg:'–ó–∏–º–∞',en:'Winter'},p_equinox:{bg:'–†–∞–≤–Ω–æ–¥–µ–Ω—Å—Ç–≤–∏–µ',en:'Equinox'},preset_annual:{bg:'–ì–æ–¥–∏—à–µ–Ω –æ–ø—Ç–∏–º—É–º: 180¬∞ —é–≥, 36¬∞ –Ω–∞–∫–ª–æ–Ω.',en:'Annual: 180¬∞ south, 36¬∞ tilt.'},preset_summer:{bg:'–õ—è—Ç–æ: 180¬∞, 15¬∞ –ø–ª–æ—Å—ä–∫.',en:'Summer: 180¬∞, 15¬∞ flat.'},preset_winter:{bg:'–ó–∏–º–∞: 195¬∞ —é–≥–æ–∑–∞–ø–∞–¥, 60¬∞ —Å—Ç—Ä—ä–º–µ–Ω.',en:'Winter: 195¬∞ SSW, 60¬∞ steep.'},preset_equinox:{bg:'–†–∞–≤–Ω–æ–¥–µ–Ω—Å—Ç–≤–∏–µ: 180¬∞, 42¬∞.',en:'Equinox: 180¬∞, 42¬∞.'},preset_manual:{bg:'–†—ä—á–µ–Ω —Ä–µ–∂–∏–º.',en:'Manual mode.'},l_azimuth:{bg:'–ê–∑–∏–º—É—Ç (–ø–æ—Å–æ–∫–∞)',en:'Azimuth'},az_s:{bg:'–Æ–≥ 180¬∞',en:'South 180¬∞'},l_tilt:{bg:'–ù–∞–∫–ª–æ–Ω –Ω–∞ –ø–∞–Ω–µ–ª–∏—Ç–µ',en:'Panel tilt'},tip_tilt:{bg:'0¬∞=—Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–Ω–æ. 90¬∞=—Å—Ç–µ–Ω–∞. –û–ø—Ç–∏–º–∞–ª–Ω–æ 35‚Äì38¬∞.',en:'0¬∞=flat. 90¬∞=wall. Optimal 30‚Äì38¬∞.'},l_str2:{bg:'Ôºã –í—Ç–æ—Ä–∏ —Å—Ç—Ä–∏–Ω–≥ (–≤—Ç–æ—Ä–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)',en:'Ôºã Second string'},l_share:{bg:'–î—è–ª –æ—Ç –æ–±—â–∞—Ç–∞ –º–æ—â–Ω–æ—Å—Ç',en:'Power share'},l_az2:{bg:'–ê–∑–∏–º—É—Ç –Ω–∞ —Å—Ç—Ä–∏–Ω–≥ 2',en:'String 2 azimuth'},l_tilt2:{bg:'–ù–∞–∫–ª–æ–Ω –Ω–∞ —Å—Ç—Ä–∏–Ω–≥ 2',en:'String 2 tilt'},s_fence_or:{bg:'–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –æ–≥—Ä–∞–¥–∞—Ç–∞',en:'Fence orientation'},l_fence_dir:{bg:'–ü–æ—Å–æ–∫–∞ –Ω–∞ –æ–≥—Ä–∞–¥–∞—Ç–∞',en:'Fence direction'},f_all:{bg:'–í—Å–∏—á–∫–∏ –ø–æ—Å–æ–∫–∏',en:'All directions'},tip_bifacial:{bg:'–ü—Ä–æ–∏–∑–≤–µ–∂–¥–∞—Ç –∏ –æ—Ç–∑–∞–¥. 5‚Äì25% –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–æ.',en:'Produce from both sides. 5‚Äì25% extra.'},s_losses:{bg:'–°–∏—Å—Ç–µ–º–Ω–∏ –∑–∞–≥—É–±–∏',en:'System losses'},tip_losses:{bg:'12‚Äì16% –Ω–æ—Ä–º–∞–ª–Ω–æ.',en:'12‚Äì16% normal.'},l_sysloss:{bg:'–ö–∞–±–µ–ª–∏, –∏–Ω–≤–µ—Ä—Ç–æ—Ä, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',en:'Cables, inverter, temperature'},s_location:{bg:'–°–ª—ä–Ω—á–µ–≤–∞ —Ä–∞–¥–∏–∞—Ü–∏—è –∏ –∑–∞—Å–µ–Ω—á–≤–∞–Ω–µ',en:'Irradiation and shading'},l_irr:{bg:'–°–ª—ä–Ω—á–µ–≤–∞ —Ä–∞–¥–∏–∞—Ü–∏—è',en:'Solar irradiation'},tip_irr:{bg:'–°–æ—Ñ–∏—è‚âà3.8, –°–∞–Ω–¥–∞–Ω—Å–∫–∏‚âà4.2.',en:'Munich‚âà3.4, Berlin‚âà3.0.'},h_north:{bg:'–°–µ–≤–µ—Ä–Ω–∞ –ï–≤—Ä–æ–ø–∞',en:'Northern Europe'},h_south:{bg:'–Æ–∂–Ω–∞ –ï–≤—Ä–æ–ø–∞',en:'Southern Europe'},l_micro:{bg:'–ú–∏–∫—Ä–æ–∫–ª–∏–º–∞—Ç',en:'Microclimate'},tip_micro:{bg:'–ü–ª–∞–Ω–∏–Ω—Å–∫–∏: +10‚Äì20%. –°–º–æ–≥: ‚àí10‚Äì20%.',en:'Mountain: +10‚Äì20%. Smog: ‚àí10‚Äì20%.'},h_smog:{bg:'‚àí20% —Å–º–æ–≥',en:'‚àí20% smog'},h_mountain:{bg:'+20% –ø–ª–∞–Ω–∏–Ω—Å–∫–∏',en:'+20% mountain'},l_shadefar:{bg:'–î–∞–ª–µ—á–Ω–æ –∑–∞—Å–µ–Ω—á–≤–∞–Ω–µ',en:'Far shading'},l_shadenear:{bg:'–ë–ª–∏–∑–∫–æ –∑–∞—Å–µ–Ω—á–≤–∞–Ω–µ',en:'Near shading'},s_consumption:{bg:'–ú–µ—Å–µ—á–Ω–∞ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥–∏—è',en:'Monthly electricity consumption'},tip_consumption:{bg:'3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: –±–∏—Ç–æ–≤–∞ + EV + –æ—Ç–æ–ø–ª–µ–Ω–∏–µ.',en:'3 components: household + EV + heating.'},l_selfcon:{bg:'–°–∞–º–æ–∫–æ–Ω—Å—É–º–∞—Ü–∏—è',en:'Self-consumption'},tip_selfcon:{bg:'–ú–∞–∫—Å –∑–∞–≤–∏—Å–∏ –æ—Ç EV –∏ –±–∞—Ç–µ—Ä–∏—è.',en:'Max depends on EV and battery.'},l_battery:{bg:'–ë–∞—Ç–µ—Ä–∏—è –∑–∞ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ',en:'Battery storage'},o_nobat:{bg:'–ë–µ–∑ –±–∞—Ç–µ—Ä–∏—è',en:'No battery'},tip_battery:{bg:'–°—ä—Ö—Ä–∞–Ω—è–≤–∞ –∏–∑–ª–∏—à—ä–∫–∞. –ù–∞–º–∞–ª—è–≤–∞ –∑–∞–≥—É–±–∏—Ç–µ.',en:'Stores surplus. Reduces losses.'},l_batcost:{bg:'–¶–µ–Ω–∞ –Ω–∞ –±–∞—Ç–µ—Ä–∏—è—Ç–∞ (–æ–±—â–∞)',en:'Battery cost (total)'},s_finance:{bg:'–§–∏–Ω–∞–Ω—Å–æ–≤–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏',en:'Financial parameters'},l_buyprice:{bg:'–¶–µ–Ω–∞ –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥–∏—è—Ç–∞',en:'Electricity price'},l_feedin:{bg:'–ò–∑–∫—É–ø–Ω–∞ —Ü–µ–Ω–∞ –Ω–∞ –∏–∑–ª–∏—à—ä–∫–∞',en:'Feed-in tariff'},l_syscost:{bg:'–¶–µ–Ω–∞ –Ω–∞ —Å–æ–ª–∞—Ä–Ω–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ (–æ–±—â–∞)',en:'Solar system cost (total)'},l_subsidy:{bg:'–°—É–±—Å–∏–¥–∏—è –∏–ª–∏ –≥—Ä–∞–Ω—Ç',en:'Subsidy or grant'},l_escalation:{bg:'–ì–æ–¥–∏—à–Ω–æ –ø–æ—Å–∫—ä–ø–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫–∞',en:'Annual price increase'},tip_esc:{bg:'3‚Äì5%/–≥–æ–¥–∏–Ω–∞.',en:'3‚Äì5%/year.'},r_annual:{bg:'–ì–æ–¥–∏—à–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ',en:'Annual production'},r_selfcon:{bg:'–°–∞–º–æ–∫–æ–Ω—Å—É–º–∏—Ä–∞–Ω–æ',en:'Self-consumed'},r_export:{bg:'–ü—Ä–æ–¥–∞–¥–µ–Ω–æ',en:'Exported'},r_loss:{bg:'–û–±—â–∏ –∑–∞–≥—É–±–∏',en:'Total losses'},r_chart:{bg:'‚ö° –ú–µ—Å–µ—á–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —Å–ø—Ä—è–º–æ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è',en:'‚ö° Monthly production vs consumption'},lg_prod:{bg:'–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ',en:'Production'},lg_cons:{bg:'–ö–æ–Ω—Å—É–º–∞—Ü–∏—è',en:'Consumption'},lg_click:{bg:'‚Üê –∫–ª–∏–∫–Ω–µ—Ç–µ –±–∞—Ä –∑–∞ –¥–µ—Ç–∞–π–ª–∏',en:'‚Üê click bar for details'},r_savings:{bg:'–ì–æ–¥–∏—à–Ω–∏ —Å–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è',en:'Annual savings'},lg_saved:{bg:'–°–ø–µ—Å—Ç–µ–Ω —Ç–æ–∫',en:'Saved'},lg_sold:{bg:'–ò–∑–∫—É–ø–µ–Ω —Ç–æ–∫',en:'Sold'},r_roi:{bg:'–í—ä–∑–≤—Ä—ä—â–∞–µ–º–æ—Å—Ç –∑–∞ 25 –≥–æ–¥–∏–Ω–∏',en:'ROI over 25 years'},ri_invest:{bg:'–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è',en:'Investment'},ri_payback:{bg:'–ò–∑–ø–ª–∞—â–∞–Ω–µ',en:'Payback'},ri_profit:{bg:'–ü–µ—á–∞–ª–±–∞',en:'Profit'},r_note:{bg:'–í–∫–ª—é—á–≤–∞ 0.5% –≥–æ–¥–∏—à–Ω–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è, 3-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è —Å –∫–∞–º–±–∞–Ω–∞ –∑–∞ –æ—Ç–æ–ø–ª–µ–Ω–∏–µ, CO‚ÇÇ 0.45 kg/kWh (–ë–ì –º–∏–∫—Å).',en:'Includes 0.5% degradation, 3-component consumption with heating bell curve, CO‚ÇÇ 0.40 kg/kWh (DE mix).'},st_ok:{bg:'–î–æ–±—Ä–∏ —É—Å–ª–æ–≤–∏—è',en:'Good conditions'},st_full:{bg:'–ü–æ–∫—Ä–∏–≤–∞ —Ü—è–ª–∞—Ç–∞ –≥–æ–¥–∏—à–Ω–∞ –∫–æ–Ω—Å—É–º–∞—Ü–∏—è',en:'Covers all annual consumption'},st_low:{bg:'–ü–æ–∫—Ä–∏–≤–∞ –ø–æ–¥ 50% –æ—Ç –∫–æ–Ω—Å—É–º–∞—Ü–∏—è—Ç–∞',en:'Covers less than 50%'},st_shade:{bg:'–í–∏—Å–æ–∫–æ –∑–∞—Å–µ–Ω—á–≤–∞–Ω–µ',en:'High shading'},st_shade2:{bg:'–ó–∞—Å–µ–Ω—á–≤–∞–Ω–µ –Ω–∞–¥ —Å—Ä–µ–¥–Ω–æ—Ç–æ',en:'Above-avg shading'},st_orient:{bg:'–ù–µ–æ–ø—Ç–∏–º–∞–ª–Ω–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è',en:'Non-optimal orientation'},r_lost:{bg:'–ó–∞–≥—É–±–µ–Ω –≤ –º—Ä–µ–∂–∞—Ç–∞',en:'Lost to grid'},r_sold:{bg:'–ü—Ä–æ–¥–∞–¥–µ–Ω–æ –Ω–∞ –º—Ä–µ–∂–∞—Ç–∞',en:'Sold to grid'}};

function setLang(l){lang=l;document.querySelectorAll('.lang-btn').forEach(function(b){b.classList.toggle('active',b.dataset.lang===l)});document.querySelectorAll('[data-t]').forEach(function(el){var k=el.dataset.t;if(T[k]&&T[k][l])el.textContent=T[k][l]});applyDefaults(l);initChart();recalc()}
function applyDefaults(l){var d=DEFS[l]||DEFS.bg;$('irr').value=d.irr;$('mic').value=d.mic;$('sl').value=d.sl;$('pr').value=d.pr;$('fi').value=d.fi;$('sc2').value=d.sc2;$('sub').value=d.sub;$('esc').value=d.esc;$('bc').value=d.bc;$('conH').value=d.conH;$('conEV').value=d.conEV;$('conHeat').value=d.conHeat}
function resetAll(){$('area').value=50;$('mode').value='roof';$('tilt').value=36;$('bif').value=10;$('sf').value=0;$('sn').value=0;$('sc').value=30;$('bat').value='0';$('s2s').value=30;$('t2').value=36;str2=false;$('str2Hdr').classList.remove('open');$('str2B').classList.remove('open');$('roofBlock').style.display='';$('fenceBlock').style.display='none';selM=0;$('mdetail').classList.remove('show');applyDefaults(lang);az1=180;az2=270;fDir='S';document.querySelectorAll('#azBtns .pill').forEach(function(b){b.classList.toggle('on',+b.dataset.az===180)});applyPreset('annual')}
function toggleTip(el){var w=el.classList.contains('open');document.querySelectorAll('.tip.open').forEach(function(t){t.classList.remove('open')});if(!w)el.classList.add('open')}
document.addEventListener('click',function(e){if(!e.target.closest('.tip'))document.querySelectorAll('.tip.open').forEach(function(t){t.classList.remove('open')})});
function orientF(az,tilt,m){var d=Math.min(90,Math.abs(az-180));var af=.65+.35*Math.max(0,Math.cos(d*Math.PI/180));var td=Math.abs(tilt-OT[m]);var tf=Math.exp(-Math.log(2)*Math.pow(td/25,2));return .25+.75*af*tf}

function initChart(){var c=$('chart');c.innerHTML='';var mns=lang==='bg'?MN:MNE;for(var m=1;m<=12;m++){var col=document.createElement('div');col.id='bc'+m;col.className='chart-bar-col';col.dataset.m=m;col.style.cssText='display:flex;flex-direction:column;align-items:center;height:100%;gap:0';col.innerHTML='<div style="display:flex;gap:1px;font-size:7px;font-family:JetBrains Mono,monospace;white-space:nowrap;min-height:14px;font-weight:700"><span id="bk'+m+'" style="color:var(--sun)">0</span><span style="color:var(--dim)">/</span><span id="ck'+m+'" style="color:var(--cyan)">0</span></div><div style="position:relative;flex:1;width:100%;display:flex;gap:1px"><div id="be'+m+'" style="position:absolute;bottom:0;left:0;width:48%;border-radius:3px 3px 0 0;background:linear-gradient(180deg,var(--sun),#c88a10);min-height:1px;transition:height .3s"></div><div id="b2e'+m+'" style="position:absolute;bottom:0;right:0;width:48%;border-radius:3px 3px 0 0;background:var(--cyan);opacity:.6;transition:height .3s"></div></div><div style="font-size:7.5px;color:var(--dim);font-family:JetBrains Mono,monospace;margin-top:2px">'+mns[m]+'</div>';col.onclick=function(){var mm=+this.dataset.m;selM=(selM===mm)?0:mm;recalc()};c.appendChild(col)}}

function applyPreset(k){preset=k;if(k!=='manual'){var p=PRS[k];az1=p.az;$('tilt').value=p.tilt;document.querySelectorAll('#azBtns .pill').forEach(function(b){b.classList.toggle('on',+b.dataset.az===az1)})}document.querySelectorAll('#presetBar .pbtn').forEach(function(b){b.classList.toggle('on',b.dataset.p===k)});$('presetNote').textContent=(T['preset_'+k]&&T['preset_'+k][lang])||'';recalc()}
function toggleStr2(){str2=!str2;$('str2Hdr').classList.toggle('open',str2);$('str2B').classList.toggle('open',str2);recalc()}

function recalc(){
  var mode=$('mode').value,area=+$('area').value,kwp=area*.20;
  var irrB=+$('irr').value,micF=1+(+$('mic').value/100);
  var sysL=+$('sl').value/100,fSh=+$('sf').value/100,nSh=+$('sn').value/100;
  var prBuy=+$('pr').value,prFeed=+$('fi').value;
  var conH=+$('conH').value,conEV=+$('conEV').value,conHeat=+$('conHeat').value;
  var scPct=+$('sc').value/100;
  var batKwh=+$('bat').value,batTotal=+$('bc').value;
  var pvTotal=+$('sc2').value,subsidy=+$('sub').value,escR=+$('esc').value/100;
  var prodF=(1-sysL)*(1-fSh)*(1-nSh),lossP=(1-prodF)*100;
  var hasEV=conEV>0,hasBat=batKwh>0,scMax=50;
  if(hasEV&&hasBat)scMax=95;else if(hasBat)scMax=90;else if(hasEV)scMax=75;
  $('sc').max=scMax;if(+$('sc').value>scMax)$('sc').value=scMax;scPct=+$('sc').value/100;
  $('scMaxHint').textContent=(lang==='bg'?'–º–∞–∫—Å–∏–º—É–º ':'maximum ')+scMax+'%';
  var batBoost=hasBat?Math.min(.25,batKwh*.02):0;
  var evBoost=hasEV?0.12:0;
  var totalSC=Math.min(scMax/100,scPct+batBoost+evBoost);
  // Monthly arrays: production completely independent from consumption
  mP=[0];mC=[0];var conY=0,yP=0;
  for(var m=1;m<=12;m++){
    var irr=irrB*MF[m],d;
    if(mode==='fence'){d=kwp*irr*micF*prodF*(FK[fDir]||.5)*(1+(+$('bif').value/100))}
    else{var t1=+$('tilt').value,o1=orientF(az1,t1,m);if(str2){var s2=+$('s2s').value/100,o2=orientF(az2,+$('t2').value,m);d=kwp*irr*micF*prodF*((1-s2)*o1+s2*o2)}else d=kwp*irr*micF*prodF*o1}
    mP.push(d*DIM[m]);yP+=d*DIM[m];
    // Consumption: house(const) + EV(const) + heat(bell curve)
    var mc=conH+conEV+(conHeat*HB[m]);
    mC.push(mc);conY+=mc}
  // Battery reduces lost energy: bigger battery absorbs more surplus
  var batAbsorb=hasBat?Math.min(0.15,batKwh*0.003):0; // up to 15% extra SC from big battery
  totalSC=Math.min(scMax/100,totalSC+batAbsorb);
  var selfC=yP*totalSC,exported=yP*(1-totalSC);
  var isLost=prFeed<0.001,savS=selfC*prBuy,savF=isLost?0:exported*prFeed,yS1=savS+savF;
  var tot25=0;for(var y=0;y<25;y++){var dg=1-y*.005,es=Math.pow(1+escR,y);tot25+=(selfC*dg*prBuy*es)+(isLost?0:exported*dg*prFeed*es)}
  var totalInv=pvTotal+(hasBat?batTotal:0)-subsidy;if(totalInv<0)totalInv=0;
  var payback=yS1>0?totalInv/yS1:Infinity,profit25=tot25-totalInv;
  var co2f=lang==='en'?0.00040:0.00045,co2=yP*25*.88*co2f;
  // UI
  var mn=lang==='bg'?MNF:MNEF,mns=lang==='bg'?MN:MNE,B=lang==='bg';
  $('areaV').textContent=area+' m¬≤';$('kwpV').textContent=kwp.toFixed(1)+' kWp';
  $('irrV').textContent=irrB.toFixed(2);$('micV').textContent=(+$('mic').value>0?'+':'')+$('mic').value+'%';
  $('sfV').textContent=$('sf').value+'%';$('snV').textContent=$('sn').value+'%';
  $('tiltV').textContent=$('tilt').value+'¬∞';$('t2V').textContent=$('t2').value+'¬∞';$('s2sV').textContent=$('s2s').value+'%';
  $('bifV').textContent=$('bif').value+'%';$('slV').textContent=(+$('sl').value).toFixed(1)+'%';
  $('prV').textContent=prBuy.toFixed(3)+' ‚Ç¨/kWh';$('fiV').textContent=prFeed.toFixed(3)+' ‚Ç¨/kWh';$('escV').textContent=$('esc').value+'%';
  $('sc2V').textContent=pvTotal.toLocaleString()+' ‚Ç¨';$('sc2hint').textContent='= '+(kwp>0?(pvTotal/kwp).toFixed(0):0)+' ‚Ç¨/kWp';
  $('subV').textContent=subsidy>0?subsidy.toLocaleString()+' ‚Ç¨':'0 ‚Ç¨';
  $('conHV').textContent=conH.toLocaleString()+' kWh/'+(B?'–º–µ—Å–µ—Ü':'month');
  $('conEVV').textContent=conEV.toLocaleString()+' kWh/'+(B?'–º–µ—Å–µ—Ü':'month');
  $('conHeatV').textContent=conHeat.toLocaleString()+' kWh/'+(B?'–º–µ—Å–µ—Ü':'month');
  $('conYV').textContent=Math.round(conY).toLocaleString()+' kWh/'+(B?'–≥–æ–¥–∏–Ω–∞':'year');
  $('scV').textContent=Math.round(totalSC*100)+'%'+(evBoost>0?(B?' (–≤–∫–ª. EV)':' (incl. EV)'):'')+(batBoost>0||batAbsorb>0?(B?' (–≤–∫–ª. –±–∞—Ç–µ—Ä–∏—è)':' (incl. battery)'):'');
  $('bcV').textContent=batTotal.toLocaleString()+' ‚Ç¨';
  var azN={90:B?'–ò–∑—Ç–æ–∫':'East',135:B?'–Æ–≥–æ–∏–∑—Ç–æ–∫':'SE',180:B?'–Æ–≥':'South',195:B?'–Æ–Æ–ó':'SSW',210:B?'–Æ–≥–æ–∑–∞–ø–∞–¥':'SW',270:B?'–ó–∞–ø–∞–¥':'West'};
  $('azV').textContent=az1+'¬∞ '+(azN[az1]||'');
  // KPIs ‚Äî always annual
  $('dayTitle').textContent=(B?'–°—Ä–µ–¥–Ω–æ –¥–Ω–µ–≤–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ':'Average daily production');
  $('oDay').textContent=(yP/365).toFixed(1)+' kWh';
  $('oYear').textContent=yP>=1e3?(yP/1e3).toFixed(2)+' MWh':yP.toFixed(0)+' kWh';
  $('oYearN').textContent=kwp.toFixed(1)+' kWp ¬∑ '+(kwp>0?(yP/kwp).toFixed(0):'0')+' kWh/kWp';
  $('oSelf').textContent=selfC>=1e3?(selfC/1e3).toFixed(2)+' MWh':selfC.toFixed(0)+' kWh';$('oSelfN').textContent=Math.round(totalSC*100)+'%';
  if(isLost){$('expTitle').textContent=T.r_lost[lang];$('oExp').textContent=exported>=1e3?(exported/1e3).toFixed(2)+' MWh':exported.toFixed(0)+' kWh';$('oExp').style.color='var(--red)';$('oExpN').textContent=B?'–±–µ–∑ –¥–æ–≥–æ–≤–æ—Ä ‚Äî 0 ‚Ç¨':'no contract ‚Äî 0 ‚Ç¨'}
  else{$('expTitle').textContent=T.r_sold[lang];$('oExp').textContent=exported>=1e3?(exported/1e3).toFixed(2)+' MWh':exported.toFixed(0)+' kWh';$('oExp').style.color='';$('oExpN').textContent=Math.round((1-totalSC)*100)+'% ¬∑ '+savF.toFixed(0)+' ‚Ç¨/'+(B?'–≥–æ–¥–∏–Ω–∞':'year')}
  $('oLoss').textContent=lossP.toFixed(1)+'%';$('oLossDetail').textContent=(B?'—Å–∏—Å—Ç–µ–º–Ω–∏ ':'system ')+(sysL*100).toFixed(0)+'% ¬∑ '+(B?'—Ö–æ—Ä–∏–∑–æ–Ω—Ç ':'horizon ')+(fSh*100).toFixed(0)+'% ¬∑ '+(B?'–±–ª–∏–∑–∫–æ ':'near ')+(nSh*100).toFixed(0)+'%';
  // Month detail (click based)
  var md=$('mdetail');
  if(selM>0){
    var mPr=mP[selM],mCo=mC[selM],mSe=mPr*totalSC,mEx=mPr*(1-totalSC),mSv=mSe*prBuy+(isLost?0:mEx*prFeed),diff=mPr-mCo,pct=mCo>0?Math.round(mPr/mCo*100):0;
    md.classList.add('show');
    md.innerHTML='<div class="md-title"><span>'+mn[selM]+(B?' ‚Äî –¥–µ—Ç–∞–π–ª–∏':' ‚Äî details')+'</span><span class="md-close" onclick="selM=0;recalc()">‚úï</span></div><div class="md-row"><span>'+(B?'–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ':'Production')+'</span><span class="md-v">'+mPr.toFixed(0)+' kWh</span></div><div class="md-row"><span>'+(B?'–ö–æ–Ω—Å—É–º–∞—Ü–∏—è':'Consumption')+'</span><span class="md-v">'+mCo.toFixed(0)+' kWh ('+conH+(B?' –±–∏—Ç':' house')+' + '+conEV+' EV + '+Math.round(conHeat*HB[selM])+' '+(B?'–æ—Ç–æ–ø–ª.':'heat')+')</span></div><div class="md-row"><span>'+(B?'–ë–∞–ª–∞–Ω—Å':'Balance')+'</span><span class="md-v" style="color:'+(diff>=0?'var(--green)':'var(--red)')+'">'+(diff>=0?'+':'')+diff.toFixed(0)+' kWh ('+(diff>=0?B?'–∏–∑–ª–∏—à—ä–∫':'surplus':B?'–¥–µ—Ñ–∏—Ü–∏—Ç':'deficit')+')</span></div><div class="md-row"><span>'+(B?'–°–∞–º–æ–∫–æ–Ω—Å—É–º–∏—Ä–∞–Ω–æ':'Self-consumed')+'</span><span class="md-v">'+mSe.toFixed(0)+' kWh</span></div><div class="md-row"><span>'+(isLost?(B?'–ó–∞–≥—É–±–µ–Ω–æ –≤ –º—Ä–µ–∂–∞—Ç–∞':'Lost to grid'):(B?'–ü—Ä–æ–¥–∞–¥–µ–Ω–æ':'Sold'))+'</span><span class="md-v"'+(isLost?' style="color:var(--red)"':'')+'>'+mEx.toFixed(0)+' kWh</span></div><div class="md-row"><span>'+(B?'–°–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è –∑–∞ –º–µ—Å–µ—Ü–∞':'Monthly savings')+'</span><span class="md-v" style="color:var(--green)">'+mSv.toFixed(0)+' ‚Ç¨</span></div>';
  } else md.classList.remove('show');
  // Savings bar
  if(yS1>0){var sp=savS/(savS+Math.max(savF,.01))*100;$('segS').style.width=Math.max(12,sp)+'%';$('segS').textContent=savS.toFixed(0)+' ‚Ç¨';$('segF').style.width=Math.max(12,100-sp)+'%';$('segF').textContent=isLost?(B?'–∑–∞–≥—É–±–µ–Ω':'lost'):savF.toFixed(0)+' ‚Ç¨';$('segF').style.background=isLost?'var(--red)':'var(--blue)'}else{$('segS').style.width='50%';$('segS').textContent='0 ‚Ç¨';$('segF').style.width='50%';$('segF').textContent='0 ‚Ç¨';$('segF').style.background='var(--blue)'}
  $('riC').textContent=totalInv>=1e4?(totalInv/1e3).toFixed(1)+'k ‚Ç¨':totalInv.toFixed(0)+' ‚Ç¨';$('riP').textContent=payback<100?payback.toFixed(1)+(B?' –≥–æ–¥–∏–Ω–∏':' years'):'‚Äî';$('riR').textContent=profit25>0?(profit25>=1e4?(profit25/1e3).toFixed(1)+'k ‚Ç¨':profit25.toFixed(0)+' ‚Ç¨'):'‚Äî';$('riCO').textContent=co2.toFixed(1)+' t';
  // Chart
  var allV=[];for(var j=1;j<=12;j++){allV.push(mP[j]);allV.push(mC[j])}var maxV=Math.max.apply(null,allV)||1;
  for(var m=1;m<=12;m++){$('be'+m).style.height=Math.max(1,mP[m]/maxV*86)+'%';$('b2e'+m).style.height=Math.max(0,mC[m]/maxV*86)+'%';$('bk'+m).textContent=mP[m].toFixed(0);$('ck'+m).textContent=mC[m].toFixed(0);if(m===selM){$('be'+m).style.background='linear-gradient(180deg,#fff,var(--sun))';$('be'+m).style.boxShadow='0 0 8px rgba(245,197,66,.5)';$('bc'+m).style.background='rgba(245,197,66,.06)';$('bc'+m).style.borderRadius='6px'}else{$('be'+m).style.background='';$('be'+m).style.boxShadow='';$('bc'+m).style.background='';$('bc'+m).style.borderRadius=''}}
  // Glow
  var snEl=$('sn'),snVE=$('snV');snEl.classList.remove('warn','danger');snVE.classList.remove('warn-text','danger-text');if(nSh>.25){snEl.classList.add('danger');snVE.classList.add('danger-text')}else if(nSh>.1){snEl.classList.add('warn');snVE.classList.add('warn-text')}
  $('sl').classList.remove('warn');$('slV').classList.remove('warn-text');if(sysL>.2){$('sl').classList.add('warn');$('slV').classList.add('warn-text')}
  $('sf').classList.remove('warn');$('sfV').classList.remove('warn-text');if(fSh>.07){$('sf').classList.add('warn');$('sfV').classList.add('warn-text')}
  var pl=$('statusPill'),st=$('statusText');pl.className='status';var dO=1;if(mode!=='fence'){dO=orientF(az1,+$('tilt').value,6)}
  if(nSh>.25){pl.classList.add('danger');st.textContent=T.st_shade[lang]}else if(nSh>.1||fSh>.07){pl.classList.add('warn');st.textContent=T.st_shade2[lang]}else if(dO<.7){pl.classList.add('warn');st.textContent=T.st_orient[lang]}else if(yP<conY*.5){pl.classList.add('warn');st.textContent=T.st_low[lang]}else{pl.classList.add('ok');st.textContent=yP>=conY?T.st_full[lang]:T.st_ok[lang]}
}
var sliders=['area','irr','mic','sf','sn','tilt','t2','s2s','bif','sl','pr','fi','esc','sc2','sub','conH','conEV','conHeat','sc','bc'];
sliders.forEach(function(id){$(id).addEventListener('input',function(){if(id==='tilt'&&preset!=='manual'){preset='manual';document.querySelectorAll('#presetBar .pbtn').forEach(function(b){b.classList.toggle('on',b.dataset.p==='manual')});$('presetNote').textContent=T.preset_manual[lang]}recalc()})});
$('mode').addEventListener('change',function(){var f=$('mode').value==='fence';$('roofBlock').style.display=f?'none':'';$('fenceBlock').style.display=f?'':'none';recalc()});
$('bat').addEventListener('change',recalc);
document.querySelectorAll('#presetBar .pbtn').forEach(function(b){b.onclick=function(){applyPreset(b.dataset.p)}});
document.querySelectorAll('#azBtns .pill').forEach(function(b){b.onclick=function(){document.querySelectorAll('#azBtns .pill').forEach(function(x){x.classList.remove('on')});b.classList.add('on');az1=+b.dataset.az;if(preset!=='manual'){preset='manual';document.querySelectorAll('#presetBar .pbtn').forEach(function(p){p.classList.toggle('on',p.dataset.p==='manual')});$('presetNote').textContent=T.preset_manual[lang]}recalc()}});
document.querySelectorAll('#az2Btns .pill').forEach(function(b){b.onclick=function(){document.querySelectorAll('#az2Btns .pill').forEach(function(x){x.classList.remove('on')});b.classList.add('on');az2=+b.dataset.az2;recalc()}});
document.querySelectorAll('#fenceBtns .pill').forEach(function(b){b.onclick=function(){document.querySelectorAll('#fenceBtns .pill').forEach(function(x){x.classList.remove('on')});b.classList.add('on');fDir=b.dataset.f;recalc()}});
document.querySelectorAll('.lang-btn').forEach(function(b){b.onclick=function(){setLang(b.dataset.lang)}});
initChart();applyPreset('annual');
</script></body></html>
